/**
 * Touch Select - AngularJS touch option selector component
 * @version v0.0.1
 * @link http://kzf.github.io/AngularTouchSelect
 * @author Kevin Fray <kzfray@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */

!function(t){"use strict";function e(t){var e=t.classes.disabled,n=t.classes.hover;return{restrict:"E",replace:!0,template:'<span ng-class="elementClasses" ng-mouseover="mouseoverOption()" ng-mouseout="mouseoutOption()" style="{{positionStyle}}" ng-mouseup="selectOption()" ng-bind-html="data.text"></span>',scope:{index:"@optionIndex",data:"=optionData",radial:"=tslRadial"},link:function(t){t.$watch("data.disabled",function(){t.elementClasses["tsl-disabled"]=t.data.disabled})},controller:function(t,o){if(t.positionStyle="",t.radial){var i="translateX(-50%) translateY(-50%) translateX("+t.data.position.x+"px) translateY("+t.data.position.y+"px)";t.positionStyle="transform: "+i+"; -webkit-transform: "+i+"; -ms-transform: "+i+";"}t.elementClasses={},t.elementClasses[e]=t.data.disabled,t.mouseoverOption=function(){o.addClass(n)},t.mouseoutOption=function(){o.removeClass(n)},t.selectOption=function(){t.data.disabled||t.$emit("selectedOption",t.index)}}}}function n(t){return{restrict:"A",compile:function(e,n){var o=t(n.touchStart,null,!0);return function(t,e){e.on("touchstart",function(e){t.$apply(function(){o(t,{$event:e})})})}}}}function o(t){return{restrict:"A",compile:function(e,n){var o=t(n.touchEnd,null,!0);return function(t,e){e.on("touchend",function(e){t.$apply(function(){o(t,{$event:e})})})}}}}function i(e,n){return{restrict:"A",replace:!0,template:'<div ng-class="selectorClasses" ng-mousedown="showOptions($event)" touch-start="showOptions($event)" touch-end="touchSelectOption($event)"><span ng-bind-html="textValue"></span><div ng-class="optionsClasses"><tsl-option-button tsl-radial="isRadial" ng-repeat="option in _options" option-index="{{$index}}" option-data="option" /></div></div>',scope:{value:"=valueVar",options:"=optionsVar",updateCallback:"=updateCallback"},link:function(t){t.$watch("value",function(){t._options.forEach(function(e){e.value===t.value&&(t.textValue=e.text)})})},controller:["$scope","$element","$attrs","$document","$sce","radialPosition",function(o,i,s,a,l,r){if(!s.optionsVar||!s.valueVar)throw new Error("touch-selector directive used without settings options and value variables");var c="undefined"!=typeof s.tslRadial;o.isRadial=c;var u;c&&(u="undefined"!=typeof s.tslStartAngle&&"undefined"!=typeof s.tslEndAngle?r.arc(o.options.length,s.tslRadius||e.defaultRadius,s.tslStartAngle,s.tslEndAngle):r.circle(o.options.length,s.tslRadius||e.defaultRadius));var d=e.classes.selector,p=e.classes[c&&"center"||s.tslDirection||e.defaultDirection];o.selectorClasses=[d,p];var f=s.hiddenClass||e.classes.hidden,v=e.classes.options,h=e.classes.radial;o.optionsClasses=[f,v],c&&o.optionsClasses.push(h);var m=i.find("div");o.textValue=l.trustAsHtml(o.value.toString()),o._options=[],o.options.forEach(function(t,e){var n={};"object"!=typeof t?(n.value=t,n.text=t.toString()):(n=t,n.text||(n.text=n.value.toString())),c&&(n.position=u[e]),"string"==typeof n.text&&(n.text=l.trustAsHtml(n.text)),o._options.push(n)}),o.showOptions=function(t){if(t.preventDefault(),!m.hasClass(f))throw new Error("Tried to show options when options were already showing");if(m.removeClass(f),"mousedown"===t.type){var e=function(){m.addClass(f),a.off("mouseup",e)};a.on("mouseup",e)}},o.$on("selectedOption",function(t,e){var n=o._options[e];o.value=n.value,o.textValue=n.text});var g=function(t,e){var n;for(n=0;n<t.length;n++)if(t[n]===e)return!0;return!1};o.touchSelectOption=function(e){e.preventDefault();var i=e.changedTouches[0],s=t.element(n(i.clientX,i.clientY));if(g(m.find(s[0].tagName),s[0])){for(;void 0===s.attr("option-index");)s=s.parent();var a=s.attr("option-index"),l=o._options[a];l.disabled||o.$emit("selectedOption",a)}m.addClass(f)}}]}}t.module("touchSelect.config",[]).constant("touchSelectConfig",{classes:{selector:"tsl-selector",options:"tsl-options",hidden:"tsl-hidden",hover:"tsl-hover",disabled:"tsl-disabled",radial:"tsl-radial",top:"tsl-top",left:"tsl-left",right:"tsl-right",bottom:"tsl-bottom",center:"tsl-center"},defaultDirection:"right",defaultRadius:60}),t.module("touchSelect.directives",["ngAnimate"]),t.module("touchSelect.services",[]),t.module("touchSelect",["touchSelect.config","touchSelect.services","touchSelect.directives"]),t.module("touchSelect.directives").directive("tslOptionButton",["touchSelectConfig",e]),t.module("touchSelect.directives").directive("touchStart",["$parse",n]).directive("touchEnd",["$parse",o]),t.module("touchSelect.directives").directive("touchSelector",["touchSelectConfig","elementFromPoint",i]),t.module("touchSelect.services").factory("elementFromPoint",function(){var t,e=function(t,e){return n()||(t+=window.pageXOffset,e+=window.pageYOffset),document.elementFromPoint(t,e)},n=function(){if(null!=t)return t;var e=window.pageXOffset?window.pageXOffset+window.innerWidth-1:0,n=window.pageYOffset?window.pageYOffset+window.innerHeight-1:0;return e||n?t=!document.elementFromPoint(e,n):!0};return function(t,n){return e(t,n)}}),t.module("touchSelect.services").factory("radialPosition",function(){var t=Math.PI,e=function(t){return Math.round(1e4*t)/1e4},n=function(t,n,o,i){var s,a=[];for(s=0;t>s;s++)a.push({x:e(Math.cos(o)*n),y:e(Math.sin(o)*n)}),o+=i;return a};return{circle:function(e,o){var i=-t/2,s=2*t/e;return n(e,o,i,s)},arc:function(e,o,i,s){var a=2*t*i,l=2*t*(s-i)/(e-1);return n(e,o,a,l)}}})}(angular);